<?xml version="1.0" encoding="UTF-8"?>
<odoo>
<data>

    <record id="first_approval_cost_card_group"   model="res.groups">
        <field name="name">First Approval Cost Card</field>
        <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
    </record>

    <record id="second_approval_cost_card_group"   model="res.groups">
        <field name="name">Second Approval Cost Card</field>
        <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
    </record>

    <record id="cancel_after_approved"   model="res.groups">
        <field name="name">Cancel After Approved</field>
        <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
    </record>
<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Views Portion %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

    <!--===================== [Sale Order Extension Form View-START] ====================-->

    <record id="so_form_view_extension" model="ir.ui.view"> 
        <field name="name">so_form_view_extension</field> 
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="type">form</field> 
        <field name="arch" type="xml">

            <xpath expr="//form/header/button[@name='action_confirm'][2]" position="attributes">
                <attribute name="string" >Send for Approval</attribute>
            </xpath>


            <xpath expr="//field[@name='order_line']/tree" position="attributes">
                <attribute name="editable">top</attribute>
            </xpath>

            <xpath expr="//header/button[@name=%(sale.action_view_sale_advance_payment_inv)d]" position="replace">
                
            </xpath>


            
            <xpath expr="//header" position="inside">
                <button name="get_order_lines" string="Get Order Lines" type="object" class="oe_highlight" invisible="1"/>
               <!--  <button name="create_invoice" string="Create Invoice" type="object" class="oe_highlight" attrs="{'invisible':[('state','!=','done')]}"/> -->
                <button name="create_edari_fee" string="Create Edari Fee" type="object" class="oe_highlight" invisible="1"/>
                <!-- <button name="approve_applicant" string="Send for Approval" type="object" class="oe_highlight" attrs="{'invisible':[('applicant','=',False),('applicant_approve_check','=',False),]}"/> -->
                
                <button name="FirstApproval" string="Approve" type="object" class='oe_highlight' attrs="{'invisible':['|',('first_approval','!=',False),('state','!=','sale')]}" groups = "so_extension.first_approval_cost_card_group"/>
                    
                <button name="SecondApproval" string="Approve" type="object" class='oe_highlight' attrs="{'invisible':['|',('second_approval','!=',False),('state','!=','sale')]}" groups = "so_extension.second_approval_cost_card_group"/>

                <button name="ActionCancel" string="Cancel" type="object" class='oe_highlight' groups = "so_extension.cancel_after_approved" attrs="{'invisible':[('state','!=','done')]}"/>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="applicant" options="{'no_create_edit':True}" readonly="1"/>
                <field name="employee" options="{'no_create_edit':True}" readonly="1"/>
                <field name="contract" options="{'no_create_edit':True}" readonly = "1"/>
                <field name="contract_state" readonly = "1"/>
                <field name="no_of_months" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="per_month_gross_salary" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="costcard_type" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="job_pos" options="{'no_create_edit': True}" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="template" options="{'no_create_edit': True}" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="version" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="invoice_id" readonly="1" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="applicant_approve_check" invisible="1" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="candidate_name" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="budget" readonly = "1"/>
            </xpath>
            <xpath expr="//field[@name='payment_term_id']" position="after">
                <!-- <field name="interval"/> -->
                <field name="customer_po_no" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="work_days_type" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="leave_type" attrs="{'invisible':[('work_days_type','!=','actual_working_days')]}"/>
                <field name="contract_start_date" attrs="{'readonly':[('state','=','sale')]}" invisible = "1"/>
                <field name="contract_end_date" attrs="{'readonly':[('state','=','sale')]}" invisible = "1"/>
                <field name="estimated_start_date" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="date_invoice" attrs="{'readonly':[('state','=','sale')]}" string = "Last Invoice Month"/>
                <!-- <field name="invoice_amount" attrs="{'readonly':[('state','in',['sale','done'])]}"/> -->
                <field name="percentage" attrs="{'readonly':[('state','in',['sale','done'])]}"/>
                <field name="first_approval" readonly="1"/>
                <field name="second_approval" readonly="1"/>
                <field name="sequence_number" invisible="1"/>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', 'in', ('done','cancel','sale'))]}</attribute>
            </xpath>

            <xpath expr="/form/sheet/notebook/page[2]" position="replace">
                
            </xpath>
            <xpath expr="/form/sheet/notebook/page[3]" position="replace">
                
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='name']" position="after">
                <field name="code" attrs="{'readonly':[('costcard_type','=','fixed')]}"/>
                <field name="payment_type" attrs="{'readonly':[('costcard_type','=','fixed')]}"/>
                <field name="based_on_wd" invisible="0"/>
                <field name="costcard_type" invisible="0"/>
                <field name="manual_amount" attrs="{'readonly':[('costcard_type','!=','manual')]}"/>
                <field name="categ_id" invisible="0"/>
                <field name="recomputable" invisible="0"/>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='qty_delivered']" position="replace">
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='qty_invoiced']" position="replace">
            </xpath>
            <!--  <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='name']" position="after">
                <field name="code" attrs="{'readonly':[('costcard_type','=','fixed')]}"/>
            </xpath> -->

            <!-- Making tree fields readonly -->
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='name']" position="attributes">
                <attribute name="attrs">{'readonly': [('costcard_type','=', 'fixed')]}</attribute>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='product_uom_qty']" position="attributes">
                <attribute name="attrs">{'readonly': [('costcard_type','=', 'fixed')]}</attribute>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='price_unit']" position="attributes">
                <attribute name="attrs">{'readonly': [('costcard_type','=', 'fixed')]}</attribute>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='tax_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('costcard_type','=', 'fixed')]}</attribute>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='product_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('costcard_type','=', 'fixed')]}</attribute>
            </xpath>

            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='price_unit']" position="replace">
                <field name="price_unit" attrs="{'readonly': [('qty_invoiced', '&gt;', 0), ('costcard_type','=', 'fixed')]}" sum="Total"/>
            </xpath>

        </field> 
    </record>

    <!--********************* [Sale Order Extension Form View-ENDS] *********************-->


    <!-- inheriting External Tree view of SO quotation -->
    <record id="QutationTreeViewExtension" model="ir.ui.view"> 
        <field name="name">QutationTreeViewExtension</field> 
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_quotation_tree_with_onboarding"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name ='partner_id']" position="after">
                <field name="candidate_name"/>
            </xpath>
        </field> 
    </record>
    <!-- inheriting External Tree view of SOs -->
    <record id="SOTreeViewExtension" model="ir.ui.view"> 
        <field name="name">SOTreeViewExtension</field> 
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name ='partner_id']" position="after">
                <field name="candidate_name"/>
            </xpath>
        </field> 
    </record>


    

    <!-- Changing name of SO action -->
    <record id="sale.action_orders" model="ir.actions.act_window">
        <field name="name">Cost Cards</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
        <field name="search_view_id" ref="sale.sale_order_view_search_inherit_sale"/>
        <field name="context">{}</field>
        <field name="domain">[('state', 'not in', ('draft', 'sent', 'cancel'))]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new quotation, the first step of a new sale!
            </p><p>
                Once the quotation is confirmed, it becomes a sales order.<br/> You will be able to create an invoice and collect the payment.
            </p>
        </field>
    </record>


    <menuitem id="sale.menu_sale_order" name="Cost Cards" action="sale.action_orders" parent="sale.sale_order_menu" sequence="2" groups="sales_team.group_sale_salesman"/>


    <record id="sale.action_quotations_with_onboarding" model="ir.actions.act_window">
        <field name="name">Cost Cards Quotations</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_id" ref="sale.view_quotation_tree_with_onboarding"/>
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
        <field name="search_view_id" ref="sale.sale_order_view_search_inherit_quotation"/>
        <field name="context">{'search_default_my_quotation': 1}</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a new quotation, the first step of a new sale!
          </p><p>
            Once the quotation is confirmed by the customer, it becomes a sales order.<br/> You will be able to create an invoice and collect the payment.
          </p>
        </field>
    </record>

    <act_window
        id="create_invoices_action_button"
        name="Create Cost Card Invoices"
        res_model="create.invoice.wizard"
        binding_model="sale.order"
        target="new"
        view_mode="form"
       />

   <!--  <act_window  id="create_invoices_action_button" name="Create Invoices" src_model="sale.order" res_model="create.invoice.wizard" key2="client_action_multi" target="new" view_mode="form" multi="False" />
 -->
    <menuitem id="sale.menu_sale_quotations"
        action="sale.action_quotations_with_onboarding"
        parent="sale.sale_order_menu"
        name="Cost Cards Quotations"
        sequence="1" groups="sales_team.group_sale_salesman"/>


    <record id="activity_type"   model="mail.activity.type">
        <field name="name">Cost Card Approvals</field>
        <field name="res_model_id" ref="sale.model_sale_order"/>
    </record>

    
</data>
</odoo>


                <!-- <xpath expr="//field[@name='origin']" position="attributes">
                    <attribute name="attrs">{'invisible': [('customer','=', True)]}</attribute>
                </xpath> -->